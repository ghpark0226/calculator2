<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>잔류 카페인 계산기</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #f3f4f6;
      --card-border: #e5e7eb;
      --card-shadow: rgba(15,23,42,0.06);
      --accent: #2563eb;
      --accent-soft: #e0edff;
      --text-main: #111827;
      --text-muted: #6b7280;
    }

    * { box-sizing:border-box; }

    body {
      margin:0;
      min-height:100vh;
      font-family:-apple-system,BlinkMacSystemFont,"SF Pro Text","Segoe UI",sans-serif;
      background: radial-gradient(circle at top, #e0edff 0, #f9fafb 55%);
      color: var(--text-main);
      display:flex;
      justify-content:center;
      align-items:flex-start;
    }

    .app-shell{
      width:100%;
      max-width:960px;
      padding:24px 16px 32px;
    }

    .app {
      background:#ffffff;
      border-radius:24px;
      padding:1px;
      box-shadow:0 20px 40px var(--card-shadow);
      border:1px solid var(--card-border);
    }

    .app-inner{
      border-radius:23px;
      background:linear-gradient(135deg,#ffffff 0%,#ffffff 60%,#f3f4ff 100%);
      padding:20px 20px 18px;
    }

    h1{
      margin:0;
      font-size:1.7rem;
      letter-spacing:-0.03em;
    }

    .header-row{
      display:flex;
      justify-content:space-between;
      gap:12px;
      align-items:flex-end;
    }

    .subtitle{
      margin-top:4px;
      font-size:0.9rem;
      color:var(--text-muted);
    }

    .badge{
      font-size:0.78rem;
      padding:4px 10px;
      border-radius:999px;
      background:#eff6ff;
      border:1px solid #bfdbfe;
      color:#1d4ed8;
      white-space:nowrap;
    }

    .section{
      margin-top:18px;
      padding:12px 12px 10px;
      border-radius:16px;
      background:#f9fafb;
      border:1px solid #e5e7eb;
    }

    .section-title{
      font-size:0.9rem;
      font-weight:600;
      color:#111827;
      margin-bottom:8px;
      display:flex;
      align-items:center;
      gap:6px;
    }
    .section-title span.dot{
      width:6px;height:6px;border-radius:999px;
      background:var(--accent);
      box-shadow:0 0 0 4px rgba(37,99,235,0.2);
    }

    .picker-row{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      align-items:center;
    }

    select{
      padding:6px 9px;
      border-radius:10px;
      border:1px solid #d1d5db;
      background:#ffffff;
      color:var(--text-main);
      font-size:0.86rem;
      min-width:80px;
      outline:none;
      appearance:none;
      position:relative;
    }
    select:focus{
      border-color:var(--accent);
      box-shadow:0 0 0 1px rgba(37,99,235,0.35);
    }

    button{
      border:0;
      border-radius:999px;
      padding:7px 14px;
      font-size:0.85rem;
      cursor:pointer;
      transition:all .15s ease-out;
      font-weight:500;
    }

    .btn-primary{
      background:linear-gradient(135deg,#3b82f6,#60a5fa);
      color:white;
      box-shadow:0 12px 25px rgba(37,99,235,0.25);
    }
    .btn-primary:hover{
      transform:translateY(-1px);
      box-shadow:0 16px 35px rgba(37,99,235,0.35);
    }
    .btn-primary:active{
      transform:translateY(0);
      box-shadow:0 8px 18px rgba(37,99,235,0.25);
    }

    .btn-ghost{
      background:#ffffff;
      color:var(--text-main);
      border:1px solid #d1d5db;
      padding:5px 11px;
    }
    .btn-ghost:hover{
      background:#eff6ff;
      border-color:#93c5fd;
    }

    .current-actions{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      margin-top:8px;
    }

    .dose-header-row{
      margin-top:16px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
    }
    .dose-header-row-title{
      font-size:0.9rem;
      font-weight:600;
      color:var(--text-muted);
    }

    .dose-table-wrap{
      margin-top:8px;
      border-radius:14px;
      overflow:hidden;
      border:1px solid #e5e7eb;
      background:#ffffff;
    }

    table{
      width:100%;
      border-collapse:collapse;
      font-size:0.86rem;
    }

    thead{
      background:#f3f4f6;
    }

    thead th{
      padding:8px 10px;
      font-weight:500;
      color:var(--text-muted);
      border-bottom:1px solid #e5e7eb;
      text-align:center;
      letter-spacing:0.02em;
    }

    tbody tr{
      border-bottom:1px solid #f3f4f6;
    }

    tbody tr:last-child{
      border-bottom:none;
    }

    tbody td{
      padding:7px 8px;
      vertical-align:middle;
    }

    .dose-time-picker{
      display:flex;
      gap:6px;
      justify-content:flex-start;
      align-items:center;
    }
    .dose-time-picker select{
      min-width:84px;
      font-size:0.82rem;
    }

    .mg-cell{
      text-align:center;
    }

    .mg-input-wrap{
      display:inline-flex;
      align-items:center;
      gap:4px;
      padding:4px 8px;
      border-radius:999px;
      background:#f9fafb;
      border:1px solid #d1d5db;
    }

    .mg-input-wrap input{
      width:70px;
      border:none;
      background:transparent;
      color:var(--text-main);
      font-size:0.86rem;
      text-align:right;
      padding:0;
      outline:none;
    }

    .mg-unit{
      font-size:0.78rem;
      color:var(--text-muted);
    }

    .result-box{
      margin-top:18px;
      border-radius:16px;
      padding:14px 14px 12px;
      background:var(--accent-soft);
      border:1px solid #bfdbfe;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
    }

    .result-value{
      font-weight:600;
      font-size:1.1rem;
      letter-spacing:0.02em;
    }

    .pill{
      font-size:0.8rem;
      padding:4px 10px;
      border-radius:999px;
      border:1px solid #bfdbfe;
      background:#ffffff;
      color:#1d4ed8;
      white-space:nowrap;
    }

    @media (max-width:720px){
      .app-inner{ padding:16px 14px 14px; }
      .header-row{ flex-direction:column; align-items:flex-start; }
      .dose-time-picker{ flex-wrap:wrap; }
      .dose-time-picker select{ flex:1 1 30%; min-width:0; }
      .mg-input-wrap{ width:100%; justify-content:flex-end; }
      tbody td:nth-child(3){ text-align:right; }
      .result-box{ flex-direction:column; align-items:flex-start; }
    }
  </style>
</head>
<body>
<div class="app-shell">
  <div class="app">
    <div class="app-inner">
      <div class="header-row">
        <div>
          <h1>잔류 카페인 계산기</h1>
          <div class="subtitle">섭취한 카페인이 얼마나 남아있는지 계산합니다.</div>
        </div>
        <div class="badge">반감기 = 5시간으로 계산</div>
      </div>

      <!-- 기준 시각 -->
      <div class="section" style="margin-top:18px;">
        <div class="section-title">
          <span class="dot"></span>
          <span>현재 시각 설정</span>
        </div>
        <div class="picker-row">
          <select id="curYear"></select>
          <select id="curMonth"></select>
          <select id="curDay"></select>
          <select id="curHour"></select>
        </div>
        <div class="current-actions">
          <button class="btn-ghost" id="setNowBtn">현재 시각으로 설정</button>
        </div>
      </div>

      <!-- 섭취 기록 -->
      <div class="dose-header-row">
        <div class="dose-header-row-title">카페인 섭취 기록</div>
        <button class="btn-primary" id="addDoseBtn">+ 섭취 추가</button>
      </div>

      <div class="dose-table-wrap">
        <table class="dose-table">
          <thead>
          <tr>
            <th style="text-align:left;padding-left:14px;">연/월/일 시</th>
            <th>용량</th>
            <th></th>
          </tr>
          </thead>
          <tbody id="doseTbody"></tbody>
        </table>
      </div>

      <!-- 결과 -->
      <div class="result-box">
        <div id="resultMain" class="result-value">잔류 카페인: 0mg</div>
        <div class="pill">실제 건강 상태는 개인차가 크니 참고용으로만 사용하세요</div>
      </div>
    </div>
  </div>
</div>

<script>
  const HALF_LIFE = 5;

  function pad(n){return n<10?"0"+n:n;}

  const ySel = document.getElementById("curYear");
  const mSel = document.getElementById("curMonth");
  const dSel = document.getElementById("curDay");
  const hSel = document.getElementById("curHour");

  function populateYearOptions(){
    const now = new Date();
    for(let y = now.getFullYear()-1; y <= now.getFullYear()+1; y++){
      const op = document.createElement("option");
      op.value = y;
      op.text = y + "년";
      ySel.appendChild(op);
    }
  }

  function populateMonthOptions(){
    for(let m=1;m<=12;m++){
      const op=document.createElement("option");
      op.value=m; op.text=m+"월";
      mSel.appendChild(op);
    }
  }

  function populateDayOptions(year, month, selectedDay){
    dSel.innerHTML="";
    const last = new Date(year, month, 0).getDate();
    for(let d=1; d<=last; d++){
      const op=document.createElement("option");
      op.value=d; op.text=d+"일";
      if(d===selectedDay) op.selected=true;
      dSel.appendChild(op);
    }
  }

  function populateHourOptions(){
    for(let h=0;h<24;h++){
      const op=document.createElement("option");
      op.value=h; op.text=pad(h)+"시";
      hSel.appendChild(op);
    }
  }

  function setCurrentToNow(){
    const now = new Date();
    ySel.value = now.getFullYear();
    mSel.value = now.getMonth()+1;
    populateDayOptions(now.getFullYear(), now.getMonth()+1, now.getDate());
    hSel.value = now.getHours();
    autoCalc();
  }

  function initCurrentPicker(){
    populateYearOptions();
    populateMonthOptions();
    populateHourOptions();
    setCurrentToNow();

    ySel.onchange = () => {
      const day = parseInt(dSel.value) || 1;
      populateDayOptions(parseInt(ySel.value), parseInt(mSel.value), Math.min(day, new Date(parseInt(ySel.value), parseInt(mSel.value), 0).getDate()));
      autoCalc();
    };
    mSel.onchange = () => {
      const day = parseInt(dSel.value) || 1;
      populateDayOptions(parseInt(ySel.value), parseInt(mSel.value), Math.min(day, new Date(parseInt(ySel.value), parseInt(mSel.value), 0).getDate()));
      autoCalc();
    };
    dSel.onchange = autoCalc;
    hSel.onchange = autoCalc;

    document.getElementById("setNowBtn").onclick = setCurrentToNow;
  }

  function getNowDate(){
    const y = parseInt(ySel.value);
    const m = parseInt(mSel.value);
    const d = parseInt(dSel.value);
    const h = parseInt(hSel.value);
    return new Date(`${y}-${pad(m)}-${pad(d)}T${pad(h)}:00`);
  }

  function addDoseRow(){
    const tbody = document.getElementById("doseTbody");
    const tr = document.createElement("tr");
    tbody.appendChild(tr);

    tr.innerHTML = `
      <td class="pick"></td>
      <td class="mg-cell">
        <div class="mg-input-wrap">
          <input type="number" min="0" step="10" />
          <span class="mg-unit">mg</span>
        </div>
      </td>
      <td style="text-align:center;">
        <button class="btn-ghost del">삭제</button>
      </td>
    `;

    const baseDate = getNowDate();
    createTimePickerForRow(tr, baseDate);

    tr.querySelector(".del").onclick = () => { tr.remove(); autoCalc(); };
    tr.querySelector("input").oninput = autoCalc;

    autoCalc();
  }

  function createTimePickerForRow(tr, date){
    const td = tr.querySelector(".pick");
    td.innerHTML = `
      <div class="dose-time-picker">
        <select class="y"></select>
        <select class="m"></select>
        <select class="d"></select>
        <select class="h"></select>
      </div>
    `;

    const ySelR = td.querySelector(".y");
    const mSelR = td.querySelector(".m");
    const dSelR = td.querySelector(".d");
    const hSelR = td.querySelector(".h");

    const curYear = new Date().getFullYear();

    for(let y = curYear-1; y <= curYear+1; y++){
      const op = document.createElement("option");
      op.value = y;
      op.text = y + "년";
      if(y === date.getFullYear()) op.selected = true;
      ySelR.appendChild(op);
    }

    for(let m=1;m<=12;m++){
      const op=document.createElement("option");
      op.value=m; op.text=m+"월";
      if(m===date.getMonth()+1) op.selected=true;
      mSelR.appendChild(op);
    }

    function loadDaysRow(selected){
      dSelR.innerHTML="";
      const year = parseInt(ySelR.value);
      const month = parseInt(mSelR.value);
      const last = new Date(year, month, 0).getDate();
      for(let d=1; d<=last; d++){
        const op=document.createElement("option");
        op.value=d; op.text=d+"일";
        if(d===selected) op.selected=true;
        dSelR.appendChild(op);
      }
    }
    loadDaysRow(date.getDate());

    for(let h=0;h<24;h++){
      const op=document.createElement("option");
      op.value=h; op.text=pad(h)+"시";
      if(h===date.getHours()) op.selected=true;
      hSelR.appendChild(op);
    }

    [ySelR,mSelR,dSelR,hSelR].forEach(sel => sel.onchange = autoCalc);
  }

  function autoCalc(){
    const calcTime = getNowDate();
    const rows = document.querySelectorAll("#doseTbody tr");
    const lambda = Math.LN2 / HALF_LIFE;

    let sumNow = 0;

    rows.forEach(row => {
      const td = row.querySelector(".pick");
      const y = parseInt(td.querySelector(".y").value);
      const m = parseInt(td.querySelector(".m").value);
      const d = parseInt(td.querySelector(".d").value);
      const h = parseInt(td.querySelector(".h").value);
      const mg = parseFloat(row.querySelector("input").value);
      if(!mg) return;

      const t = new Date(`${y}-${pad(m)}-${pad(d)}T${pad(h)}:00`);
      const diff = (calcTime - t) / 3600000;
      if(diff >= 0){
        sumNow += mg * Math.exp(-lambda * diff);
      }
    });

    const left = Math.round(sumNow);
    document.getElementById("resultMain").innerHTML =
      `잔류 카페인: ${left}mg`;
  }

  initCurrentPicker();
  autoCalc();
  document.getElementById("addDoseBtn").onclick = addDoseRow;
</script>
</body>
</html>

